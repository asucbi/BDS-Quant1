<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Module 7: Lab Starter KEY</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="07-lab-starter-key_files/libs/clipboard/clipboard.min.js"></script>
<script src="07-lab-starter-key_files/libs/quarto-html/quarto.js"></script>
<script src="07-lab-starter-key_files/libs/quarto-html/popper.min.js"></script>
<script src="07-lab-starter-key_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="07-lab-starter-key_files/libs/quarto-html/anchor.min.js"></script>
<link href="07-lab-starter-key_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="07-lab-starter-key_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="07-lab-starter-key_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="07-lab-starter-key_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="07-lab-starter-key_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Module 7: Lab Starter KEY</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="purpose" class="level1">
<h1>Purpose</h1>
<p>In today’s lab, we will practice centering, standardizing, and log transforming data. We will also work with polynomial data and, for all topics, we will discuss interpretation.</p>
<p>For today’s lab, you will need to load the following libraries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(papaja) <span class="co">#for formatting p values</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr) <span class="co">#for formatting tables</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych) <span class="co">#for generating easy descriptives</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effectsize) <span class="co">#for generating effect sizes</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance) <span class="co">#for checking multicollinaerity</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="research-scenario" class="level1">
<h1>Research scenario</h1>
<p>For the first part of today’s lab, we will be examining predictors of population size in the US.</p>
<section id="read-in-the-data" class="level2">
<h2 class="anchored" data-anchor-id="read-in-the-data">Read in the data</h2>
<p>First, let’s read in the data and then use <code>View()</code> to check it out.</p>
<p>Today’s dataset is called <code>pop_predictors.csv</code>. Let’s read it in and name it <code>pop</code>.</p>
<p>The data has 4 columns:</p>
<ul>
<li>state: the state in which the data were collected</li>
<li>population: population size (in the late 80s / early 90s)</li>
<li>income: average income (in the late 80s / early 90s)</li>
<li>winter: average temperature during winter months</li>
</ul>
</section>
</section>
<section id="we-should-always-examine-our-data-first" class="level1">
<h1>We should always examine our data first!</h1>
<p>Let’s start by using the <code>describe()</code> function in the <code>{psych}</code> package to examine our data.</p>
<blockquote class="blockquote">
<p><strong>Question: What do you noticed about the means and standard deviations of our variables? …range? …scale?</strong></p>
</blockquote>
</section>
<section id="centering" class="level1">
<h1>Centering</h1>
<p>First, without doing any transformations, run a model predicting population from income. Get a summary of your model.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = population ~ income, data = pop)

Residuals:
   Min     1Q Median     3Q    Max 
 -6478  -2729  -1097    775  22343 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept) -4006.2911  4354.3159  -0.920   0.3623  
income          0.3191     0.1496   2.132   0.0383 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5309 on 46 degrees of freedom
  (2 observations deleted due to missingness)
Multiple R-squared:  0.08996,   Adjusted R-squared:  0.07018 
F-statistic: 4.547 on 1 and 46 DF,  p-value: 0.03834</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Question: How would you interpret the intercept? Is this meaningful?</strong></p>
</blockquote>
<p>Now, let’s center the income variable and re-run the regression.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 5
   state population income winter income_c
   &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
 1 ME          1228  27854     22       NA
 2 NH          1109  36329     22       NA
 3 VT           563  29792     16       NA
 4 MA          6016  36952     30       NA
 5 RI          1003  32181     32       NA
 6 CT          3287  41721     30       NA
 7 NY         17990  32965     28       NA
 8 NJ          7730  40927     35       NA
 9 PA         11882  29069     32       NA
10 OH         10847  28706     31       NA
# ℹ 40 more rows</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 5
   state population income winter income_c
   &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
 1 ME          1228  27854     22   -790. 
 2 NH          1109  36329     22   7685. 
 3 VT           563  29792     16   1148. 
 4 MA          6016  36952     30   8308. 
 5 RI          1003  32181     32   3537. 
 6 CT          3287  41721     30  13077. 
 7 NY         17990  32965     28   4321. 
 8 NJ          7730  40927     35  12283. 
 9 PA         11882  29069     32    425. 
10 OH         10847  28706     31     62.2
# ℹ 40 more rows</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = population ~ income_c, data = pop)

Residuals:
   Min     1Q Median     3Q    Max 
 -6478  -2729  -1097    775  22343 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 5134.2500   766.3430   6.700 2.57e-08 ***
income_c       0.3191     0.1496   2.132   0.0383 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5309 on 46 degrees of freedom
  (2 observations deleted due to missingness)
Multiple R-squared:  0.08996,   Adjusted R-squared:  0.07018 
F-statistic: 4.547 on 1 and 46 DF,  p-value: 0.03834</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Question: How would you interpret the intercept? Is this meaningful?</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Question: How would you interpret the slope?</strong></p>
</blockquote>
<p>Now, let’s try a multiple regression. Predict population from income centered and winter temperature. Get a summary of your model.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = population ~ income_c + winter, data = pop)

Residuals:
   Min     1Q Median     3Q    Max 
 -6987  -2586  -1237   1293  18035 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -1754.0309  2070.7451  -0.847 0.401448    
income_c        0.3821     0.1351   2.828 0.006972 ** 
winter        206.6484    58.6159   3.525 0.000985 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4752 on 45 degrees of freedom
  (2 observations deleted due to missingness)
Multiple R-squared:  0.2869,    Adjusted R-squared:  0.2552 
F-statistic: 9.053 on 2 and 45 DF,  p-value: 0.0004962</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Question: How would you interpret the intercept? Is this meaningful?</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Question: How would you interpret the slope for income_c?</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Question: How would you interpret the slope for winter?</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Question: How would you summarize your findings?</strong></p>
</blockquote>
<p>Now, let’s get confidence intervals and effect sizes for each of our predictors.</p>
<p>We get CIs using the <code>confint()</code> function and effect size using <code>eta_squared()</code> in the <code>{effectsize}</code> package. We want eta squared, NOT partial eta squared. How would you specify that in the function? (hint: check out the <code>help</code> info)</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                    2.5 %       97.5 %
(Intercept) -5924.7255866 2416.6637554
income_c        0.1099422    0.6542058
winter         88.5899990  324.7068560</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># Effect Size for ANOVA (Type I)

Parameter | Eta2 |       95% CI
-------------------------------
income_c  | 0.09 | [0.00, 1.00]
winter    | 0.20 | [0.05, 1.00]

- One-sided CIs: upper bound fixed at [1.00].</code></pre>
</div>
</div>
</section>
<section id="standardizing" class="level1">
<h1>Standardizing</h1>
<p>Now, let’s say we want to know whether income or winter temperature is the stronger predictor of population. In the previous model, we found the the expected increase in population for a one-unit increase in income (holding winter temp constant) is 0.38 and the expected increase for a one-unit increase in winter temp (holding income constant) is 206.65. However, because these measures are on different scales, we can’t say that the effect of temperature is bigger just because the value is larger. To make this comparison possible, we can <em>scale</em> our variables.</p>
<p>First, let’s z-score each of our variables.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>           vars  n     mean      sd   median  trimmed     mad      min      max
state*        1 50    25.50   14.58    25.50    25.50   18.53     1.00    50.00
population    2 48  5134.25 5506.11  3576.00  4161.18 3268.39   454.00 29760.00
income        3 48 28643.83 5175.34 27697.00 28297.28 4920.01 20136.00 41721.00
winter        4 48    33.33   11.93    32.00    32.98    9.64    10.00    66.00
income_c      5 48     0.00 5175.34  -946.83  -346.56 4920.01 -8507.83 13077.17
income_z      6 48     0.00    1.00    -0.18    -0.07    0.95    -1.64     2.53
winter_z      7 48     0.00    1.00    -0.11    -0.03    0.81    -1.96     2.74
              range skew kurtosis     se
state*        49.00 0.00    -1.27   2.06
population 29306.00 2.36     6.71 794.74
income     21585.00 0.62    -0.09 747.00
winter        56.00 0.43    -0.11   1.72
income_c   21585.00 0.62    -0.09 747.00
income_z       4.17 0.62    -0.09   0.14
winter_z       4.69 0.43    -0.11   0.14</code></pre>
</div>
</div>
<p>INST NOTE: mean of z-scored variables is 0 and sd is 1 – this is what we’d expect!</p>
<p>Next, run a regression predicting population from the z-scored variables you just created. Check out a summary.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = population ~ income_z + winter_z, data = pop)

Residuals:
   Min     1Q Median     3Q    Max 
 -6987  -2586  -1237   1293  18035 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   5134.3      685.9   7.486 1.95e-09 ***
income_z      1977.4      699.3   2.828 0.006972 ** 
winter_z      2465.2      699.3   3.525 0.000985 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4752 on 45 degrees of freedom
  (2 observations deleted due to missingness)
Multiple R-squared:  0.2869,    Adjusted R-squared:  0.2552 
F-statistic: 9.053 on 2 and 45 DF,  p-value: 0.0004962</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Question: How would you interpret the intercept?</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Question: How would you interpret the effect of income?</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Question: How would you interpret the effect of winter?</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Question: Which is the stronger predictor?</strong></p>
</blockquote>
<p>Compare the summary for your current model (model_4) to the summary for the previous model (model_3).</p>
<blockquote class="blockquote">
<p><strong>Question: What changes? What stays the same?</strong></p>
</blockquote>
</section>
<section id="log-transformation" class="level1">
<h1>Log Transformation</h1>
<p>Now, let’s focus on the effect of winter temperature on population size.</p>
<p>First, let’s look at the distribution of our variables.</p>
<blockquote class="blockquote">
<p><strong>Question: Which variable might we want to log transform? Why?</strong></p>
</blockquote>
<p>Log transform the population variable, then examine the distribution again.</p>
<blockquote class="blockquote">
<p><strong>Question: How does the data distribution look now?</strong></p>
</blockquote>
<p>Now, run a regression predicting population from winter temperature. Examine the summary.</p>
<blockquote class="blockquote">
<p><strong>Question: What do you need to do before you can interpret the effect of winter temp on population?</strong></p>
</blockquote>
<p>Recall that:</p>
<p><span class="math inline">\(log_b(n) = x \leftrightarrow b^x = n\)</span></p>
<p>To interpret the intercept, use the <code>exp()</code> function to put the outcome variable back into original units.</p>
<blockquote class="blockquote">
<p><strong>Question: How would you interpret the intercept?</strong></p>
</blockquote>
<p>Now, use the following steps to interpret the slope:</p>
<ol type="1">
<li>expotentiate the coefficient</li>
<li>subtract one from this number</li>
<li>multiply by one hundred to get a percentage</li>
</ol>
<p>For every one-unit increase in our predictor, our dependent variable increases/decreases by this percent.</p>
<blockquote class="blockquote">
<p><strong>Question: How would you interpret the slope?</strong></p>
</blockquote>
</section>
<section id="polynomials" class="level1">
<h1>Polynomials</h1>
</section>
<section id="research-scenario-1" class="level1">
<h1>Research scenario</h1>
<p>Using cross-sectional data, we will examine the development (change and/or stability) of conscientiousness in adulthood (age 21 to 60). Based on previous research, we hypothesize that people will increase in conscientiousness with age; however, the rate of increase will be greatest during early adulthood (20s and 30s) and slow thereafter.</p>
<blockquote class="blockquote">
<p><strong>Question: Which part of the above paragraph refers to a <em>linear</em> trend of age?</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Question: Which part of the above paragraph refers to a <em>quadratic</em> trend of age?</strong></p>
</blockquote>
<section id="read-in-the-data-1" class="level2">
<h2 class="anchored" data-anchor-id="read-in-the-data-1">Read in the data</h2>
<p>First, let’s read in the data and then use <code>View()</code> to check it out.</p>
<p>Today’s dataset is called <code>polynomial.csv</code>. Let’s read it in and name it <code>polynomial</code>.</p>
<p>The data has 2 columns:</p>
<ul>
<li>age: participant age</li>
<li>conscientiousness: score on conscientiousness measure</li>
</ul>
</section>
</section>
<section id="we-should-always-examine-our-data-first-1" class="level1">
<h1>We should always examine our data first!</h1>
<p>Let’s start by plotting the relation between conscientiousness and age.</p>
<blockquote class="blockquote">
<p><strong>Question: What do you notice about the relation between age and conscientiousness?</strong></p>
</blockquote>
<p>Fist, we will examine a linear trend of age. Run a model predicting conscientiousness from age. Check out the summary.</p>
<blockquote class="blockquote">
<p><strong>Question: How would you interpret the intercept?</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Question: How would you interpret the slope?</strong></p>
</blockquote>
<p>Even if we found a significant linear trend, we had a hypothesis about a quadratic, so let’s test that!</p>
<p>First, create the quadratic term. Then, run a model predicting conscientiousness from linear and quadratic effects of age. Check out the summary.</p>
<blockquote class="blockquote">
<p><strong>Question: What can you say about the relation between conscientiousness and age?</strong></p>
</blockquote>
<p>Let’s test a cubic trend as well. Add a cubic term to your data (age^3) and run a third model. Check out the summary.</p>
<blockquote class="blockquote">
<p><strong>Question: Which model would you choose?</strong></p>
</blockquote>
<p>Let’s compare our models using the <code>anova()</code> function and also examine the change in <em>R^2</em> across our models.</p>
<blockquote class="blockquote">
<p><strong>Question: Which model is the best fit for the data?</strong></p>
</blockquote>
<p>BUT: Let’s see if we have multicollinaerity issues with our chosen model. Use <code>check_collinaerity()</code> from the <code>{performance}</code> package to test the quadratic model.</p>
<blockquote class="blockquote">
<p><strong>Question: Do we have a problem with multicollinaerity?</strong></p>
</blockquote>
<p>Center your predictor, create the quadratic term, and run the model again. Check for multicollinaerity.</p>
<blockquote class="blockquote">
<p><strong>Question: NOW, do we have a problem with multicollinaerity?</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Question: What is your final interpretation of the relation between age and conscientiousness?</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Question: What information would you include in a summary?</strong></p>
</blockquote>
<ul>
<li>clearly define the variables</li>
<li>describe the model</li>
<li>mention both linear and quadratic terms</li>
<li>report <em>overall</em> model fit ( <em>R</em><sup>2</sup>, <em>F</em>, <em>df</em>, <em>p</em>-value)</li>
<li>report linear effect ( <em>b</em>, <em>SE</em>, <em>t</em> statistic with associated <em>df</em>, 95%CI, <em>p</em>-value, effect size)</li>
<li>interpret linear effect (e.g., as x increases/decreases, y increases/decreases)</li>
<li>report quadratic effect ( <em>b</em>, <em>SE</em>, <em>t</em> statistic with associated <em>df</em>, 95%CI, <em>p</em>-value, effect size)</li>
<li>interpret quadratic effect (e.g., the negative quadratic term suggests an inverted u-shape, where X increases with Y up to a point and then it decreases)</li>
<li>in one sentence, summarize what you found in non-statistical language</li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
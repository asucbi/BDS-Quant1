<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Module 4: Lab Instructions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="04-lab-worksheet_files/libs/clipboard/clipboard.min.js"></script>
<script src="04-lab-worksheet_files/libs/quarto-html/quarto.js"></script>
<script src="04-lab-worksheet_files/libs/quarto-html/popper.min.js"></script>
<script src="04-lab-worksheet_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="04-lab-worksheet_files/libs/quarto-html/anchor.min.js"></script>
<link href="04-lab-worksheet_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="04-lab-worksheet_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="04-lab-worksheet_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="04-lab-worksheet_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="04-lab-worksheet_files/libs/bootstrap/bootstrap-c0367b04c37547644fece4185067e4a7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Module 4: Lab Instructions</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="purpose" class="level1">
<h1>Purpose</h1>
<p>In today’s lab, we will review Multiple Regression, work with Partial and Semi-Partial Correlations, and practice significance testing for Multiple Regression.</p>
<p>For today’s lab, you will need to load the following libraries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.5.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(papaja) <span class="co">#for formatting p values</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom) <span class="co">#for formatting tables</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr) <span class="co">#for formatting tables</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ppcor) <span class="co">#for calculating partial correlations</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(easystats) <span class="co">#for assessing multicollinaerity</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="read-in-the-data" class="level2">
<h2 class="anchored" data-anchor-id="read-in-the-data">Read in the Data</h2>
<p>First, let’s read in the data and then use <code>View()</code> to check it out.</p>
<p>Today’s dataset is called <code>data_htwtage.csv</code>. Let’s read it in and name it <code>mr_data</code> (i.e., multiple regression data).</p>
<p>The data has 4 columns:</p>
<ul>
<li>name: a (not-anonymous!) participant identifier</li>
<li>age: participant age</li>
<li>height: participants’ height</li>
<li>weight: participants’ weight</li>
</ul>
<p>(pretty self-explanatory!)</p>
</section>
<section id="visualizing-relations" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-relations">Visualizing Relations</h2>
<p>We should always start by looking at our data.</p>
</section>
<section id="scatter-plot" class="level2">
<h2 class="anchored" data-anchor-id="scatter-plot">Scatter plot</h2>
<p>Scatter plots allow us to visualize the relationship between two variables. Let’s create two scatter plots of the relation between our IVs and DV using <code>ggplot()</code>.</p>
<blockquote class="blockquote">
<p><strong>Question:</strong> What do you notice about the strength and direction of the data?</p>
</blockquote>
</section>
</section>
<section id="multiple-regression" class="level1">
<h1>Multiple Regression</h1>
<p>Let’s use both <code>age</code> and <code>height</code> to predict <code>weight</code>.</p>
<p>Regress <code>weight</code> on <code>age</code> and <code>height</code>. Save the model to an object called <code>model_1</code>.</p>
<p>The results provide us with the following model:</p>
<p><span class="math display">\[W_i = -141.22 + 1.28A_i + 3.60H_i + \epsilon_i\]</span></p>
<blockquote class="blockquote">
<p><strong>Question</strong> How do we interpret each of these regression coefficients?</p>
</blockquote>
</section>
<section id="partial-regression-coefficients" class="level1">
<h1>Partial Regression Coefficients</h1>
<p>The regression coefficients corresponding to the predictors in a multiple regression model are called <em>partial regression coefficients</em>. Let’s break down what this term means.</p>
<p>A new concept that gets introduced when we have multiple predictors in the regression model is <em>redundancy</em>, which occurs when the predictors in a multiple regression model are correlated (which they often are) and there is overlap in the variability each can account for in the outcome variable. In other words, some of the variability X1 can account for in Y is <em>redundant</em> with the variability X2 can account for in Y.</p>
<center>
<img src="images/partial_reg_coeff_image.png" class="img-fluid">
</center>
<p>The <em>partial regression coefficients</em> that we obtain in the “Estimate” column from the summary output of our multiple regression model account for this redundancy. A partial regression coefficient is the relationship between a predictor variable (X1) and outcome variable (Y) when the relationship between X1 and the other predictor variable(s) in the model has been removed.</p>
<p>Let’s walk through the logic of a partial regression coefficient by re-creating the partial regression coefficient corresponding to <code>age</code> (<span class="math inline">\(b_1\)</span> = 1.28) from our multiple regression model above.</p>
</section>
<section id="re-creating-the-partial-regression-coefficient-for-age" class="level1">
<h1>Re-creating the partial regression coefficient for <code>age</code></h1>
<ol type="1">
<li>Regress <code>age</code> on <code>height</code>. Store the model in an object called <code>model_2</code></li>
</ol>
<ol start="2" type="1">
<li>Store the part of <code>age</code> that is unrelated to <code>height</code> in a new column in <code>data</code> called <code>age_resid</code>.</li>
</ol>
<ol start="3" type="1">
<li>Regress <code>weight</code> on the part of <code>age</code> that is unrelated to <code>height</code> (i.e., <code>data$age_resid</code>). Store the model in an object called <code>model_3</code>.</li>
</ol>
<ol start="4" type="1">
<li>Examine the final results using the <code>summary()</code> function.</li>
</ol>
<blockquote class="blockquote">
<p><strong>Question</strong> How does the regression coefficient corresponding to the part of <code>age</code> that is unrelated to <code>height</code> in the univariate model (i.e., <code>model_3</code>) predicting <code>weight</code> compare to the regression coefficient corresponding to <code>age</code> in the multiple regression model (i.e., <code>model_1</code>)?</p>
</blockquote>
</section>
<section id="partial-correlations-with-the-ppcor-package." class="level1">
<h1>Partial Correlations with the <code>{ppcor}</code> package.</h1>
<p>You can also use functions in the <code>{ppcor}</code> package to calculate semi-partial and partial correlations more quickly.</p>
<p>Here, we will calculate the <strong>partial</strong> correlation for age using the <code>spcor.test</code> function.</p>
</section>
<section id="significance-testing-the-model-comparison-approach" class="level1">
<h1>Significance Testing: The Model Comparison Approach</h1>
<section id="testing-the-significance-of-the-overall-model" class="level2">
<h2 class="anchored" data-anchor-id="testing-the-significance-of-the-overall-model">Testing the Significance of the Overall Model</h2>
<p>A helpful way of framing the null hypothesis we want to test is using the model comparison approach. In this approach, you construct two models. One model represents what you would expect if the null hypothesis was true, and one model represents the alternative hypothesis. The model representing the alternative hypothesis includes the predictor(s) you want to test the significance of. The model representing the null hypothesis does not include these predictor(s). These predictors should be the <em>only</em> thing that differs between the two models.</p>
<p>Testing the significance of the overall model (AKA, the omnibus test), means examining whether, as a set, both <code>age</code> and <code>height</code> account for a significant amount of variation in <code>weight</code> scores.</p>
<p>We can test this by comparing two different models:</p>
<p><span class="math display">\[Model 1: W_i = \beta_0 + \epsilon_i\]</span></p>
<p><span class="math display">\[Model 2: W_i = \beta_0 + \beta_1A_i + \beta_2H_i + \epsilon_i\]</span></p>
<p>Where the null hypothesis states:</p>
<p><span class="math display">\[H0: \beta_1 = \beta_2 = 0\]</span></p>
<p>And the alternative hypothesis states:</p>
<p><span class="math display">\[H1: \beta_1 \neq 0 \; \textrm{AND/OR} \; \beta_2 \neq 0 \]</span></p>
<p>The key to the <em>model comparison approach</em> is comparing the amount of unaccounted for error remaining when Model 1 is used compared to when Model 2 is used. Then, we can test whether the difference in the amount of unaccounted for error remaining between the two models is significant.</p>
<p>Let’s run Model 1 (the intercept-only model) and see how much error is left unaccounted for. Save Model 1 to <code>model_1</code>.</p>
<p>Let me introduce a new way of looking at the output of a regression analysis, the <code>anova()</code> function. This function gives us the SSE (the amount of unaccounted for error remaining in Model 1).</p>
<p>The Sum of Squares on the <em>residuals</em> row corresponds to the SSE. That is, if you were to calculate the distance between each person’s actual weight and the weight predicted by the model (in this case, the mean), square those distances, and sum them up, you would get 9335.737.</p>
<p>Let’s run Model 2 (now including age and height) and see how much error is left unaccounted for. Save Model 2 to <code>model_2</code>.</p>
<p>Look at the residuals row again to get the SSE. The amount of unaccounted for error remaining when we use model 2 is 2120.1. An improvement from Model 1!</p>
<p>How much was SSE reduced by using Model 2 instead of Model 1? Save the output to a variable called <code>ssr</code> (i.e., sum of squares reduced).</p>
</section>
<section id="model-comparison-in-a-single-step-using-the-anova-function" class="level2">
<h2 class="anchored" data-anchor-id="model-comparison-in-a-single-step-using-the-anova-function">Model Comparison in a Single Step Using the <code>anova()</code> function</h2>
<p>We can give both models as arguments to the <code>anova()</code> function to make the model comparison in a single step and test whether the reduction in SSE is significant. Save the results of the model comparison to an object called <code>model_comparison</code>.</p>
<p>Let’s also calculate how much we reduced the amount of unaccounted for error using Model 2 compared to Model 1 as a proportion of the total amount of unaccounted for error we started with in Model 1. Save the output to a variable called <code>per</code> (i.e., proportion_error_reduced).</p>
<blockquote class="blockquote">
<p><strong>Question</strong> What does this proportional reduction in error mean?</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Question</strong> What is the more familiar term for this value?</p>
</blockquote>
<p>Look again at our summary output if we run our multiple regression model (i.e., <code>model_2</code>) and see how our results map on.</p>
<p>The statistics given at the bottom of the summary output correspond to a test of the significance of the <em>overall model</em> i.e., the <em>omnibus test</em>.</p>
</section>
</section>
<section id="significance-testing-the-model-comparison-approach-1" class="level1">
<h1>Significance Testing: The Model Comparison Approach</h1>
<section id="testing-the-significance-of-specific-predictors" class="level2">
<h2 class="anchored" data-anchor-id="testing-the-significance-of-specific-predictors">Testing the Significance of Specific Predictor(s)</h2>
<p>We can also construct a model comparison to represent the null hypothesis we want to test to see if a specific predictor in the model is significant. Let’s do an example testing the significance of Height in our multiple regression model.</p>
<p><span class="math display">\[Model 1: W_i = \beta_0 + \beta_1A_i + \epsilon_i\]</span></p>
<p><span class="math display">\[Model 2: W_i = \beta_0 + \beta_1A_i + \beta_2H_i + \epsilon_i\]</span></p>
<p>Where the null hypothesis states:</p>
<p><span class="math display">\[H0: \beta_2 = 0\]</span></p>
<p>And the alternative hypothesis states:</p>
<p><span class="math display">\[H1: \beta_2 \neq 0\]</span></p>
<p>Construct Model 1 and Model 2. Store in variables labelled <code>model_1</code> and <code>model_2</code>, respectively.</p>
<p>Compare the models using the <code>anova()</code> function. Save the results of the model comparison to an object called <code>model_comparison</code>.</p>
<p>Compute <span class="math inline">\(R^2\)</span>.</p>
<p>Look at summary output from Model 2 again.</p>
<p>There’s equivalence between what we’ve done using the model comparison approach and the <em>t</em>-test approach that’s used to test the significance of the specific predictors in the model in the summary output. Notice what we get if we take the square root of the F-statistic from the model comparison output.</p>
<p>And also notice the correspondence in the p-values.</p>
</section>
</section>
<section id="testing-for-multicollinaerity" class="level1">
<h1>Testing for Multicollinaerity</h1>
<blockquote class="blockquote">
<p><strong>Question</strong> Do you think there is likely to be multicollinaerity in this dataset? Why?</p>
</blockquote>
<section id="lets-identify-potential-problems-with-multicollinaerity." class="level2">
<h2 class="anchored" data-anchor-id="lets-identify-potential-problems-with-multicollinaerity.">Let’s identify potential problems with multicollinaerity.</h2>
<p>First, let’s create a correlation matrix to examine potential correlations between our variables. Make sure to select only the variables that you want to examine.</p>
<p>Next, let’s use the <code>easystats</code> package to check the Tolerance and VIF (Variance Inflation Factor) in our data. Use <code>model_2</code> that you created above.</p>
<blockquote class="blockquote">
<p><strong>Question</strong> Does it look like we have multicollinaerity in our data based on these diagnostics?</p>
</blockquote>
<p>Wait, what?? Let’s calculate Tolerance and VIF “by hand.”</p>
<p>First, we’ll get R<sub>j</sub><sup>2</sup> by predicting age from height. Call this <code>model_3</code>.</p>
<p>Next, we’ll extract the R<sub>j</sub><sup>2</sup> value from the summary.</p>
<p>We’ll then use this to calculate the Tolerance and the VIF.</p>
</section>
</section>
<section id="write-an-apa-style-summary" class="level1">
<h1>Write an APA-Style Summary</h1>
<p>This summary is based on what is now called <code>model_2</code>. Don’t forget to include a confidence interval around each of your estimates!</p>
<p>It’s helpful to create objects with each of the relevant values first.</p>
<section id="now-lets-write-the-summary" class="level2">
<h2 class="anchored" data-anchor-id="now-lets-write-the-summary">Now, let’s write the summary:</h2>
<p>A multiple linear regression was conducted to examine the the effect of age and height on weight. The overall model significantly predicted weight, F(2, 16) = 27.23, <em>p</em> = &lt; .001. The model explained a substantial proportion of variance in weight, with an R<sup>2</sup> = 0.77 and an adjusted R<sup>2</sup> = 0.74. Age was not a significant predictor of weight (<span class="math inline">\(\beta_1\)</span> = 1.28, 95% CI[-5.31, 7.87], <em>p</em> .686). However, height was a significant predictor of weight (<span class="math inline">\(\beta_2\)</span> = 3.6, 95% CI[1.68, 5.52], <em>p</em> &lt; .001), indicating that for every one-unit increase in height, weight is predicted to increase by 3.6 units, holding age constant. Overall, our model predicting weight from age and height found that height was a significant predictor while age was not.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Module 13: Lab Starter (KEY)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="13-lab-starter-shared_files/libs/clipboard/clipboard.min.js"></script>
<script src="13-lab-starter-shared_files/libs/quarto-html/quarto.js"></script>
<script src="13-lab-starter-shared_files/libs/quarto-html/popper.min.js"></script>
<script src="13-lab-starter-shared_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="13-lab-starter-shared_files/libs/quarto-html/anchor.min.js"></script>
<link href="13-lab-starter-shared_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="13-lab-starter-shared_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="13-lab-starter-shared_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="13-lab-starter-shared_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="13-lab-starter-shared_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Module 13: Lab Starter (KEY)</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="purpose" class="level1">
<h1>Purpose</h1>
<p>The goal of today’s lab is to provide you with experience running and interpreting mixed effects models.</p>
<p>For today’s lab, you will need to load the following libraries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrain) <span class="co">#for making raincloud plots</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(easystats) <span class="co">#to get ICC</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4) <span class="co">#for running multilevel (aka mixed-effects) models</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest) <span class="co">#for generating test statistics for multilevel models</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(partR2) <span class="co">#for generating semi-partial R^2</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance) <span class="co">#for examining model assumptions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="research-scenario" class="level1">
<h1>Research scenario</h1>
<p>We will use the same data we worked with last week, the data examines the effect of time spent on math homework on math achievement scores and how school type (public versus private) influences this effect.</p>
<section id="read-in-the-data" class="level2">
<h2 class="anchored" data-anchor-id="read-in-the-data">Read in the data</h2>
<p>Today’s dataset is called <code>NELS88.csv</code>. Let’s read it in and name it <code>nels</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>nels <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/NELS88.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="examine-the-data" class="level2">
<h2 class="anchored" data-anchor-id="examine-the-data">Examine the Data</h2>
<ul>
<li>Use <code>View()</code> to examine the full dataset</li>
<li>Use <code>str()</code> to look at the structure of the data</li>
<li>Use <code>head()</code> to look at the first few rows of the data</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(nels)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(nels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>spc_tbl_ [260 × 15] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ Schoolid       : num [1:260] 7472 7472 7472 7472 7472 ...
 $ studentid      : num [1:260] 3 8 13 17 27 28 30 36 37 42 ...
 $ sex            : num [1:260] 2 1 1 1 2 2 2 1 2 2 ...
 $ race           : num [1:260] 4 4 4 4 4 4 4 4 4 4 ...
 $ timeonmath     : num [1:260] 1 0 0 1 2 1 5 1 1 2 ...
 $ schooltype     : chr [1:260] "public" "public" "public" "public" ...
 $ ses            : num [1:260] -0.13 -0.39 -0.8 -0.72 -0.74 -0.58 -0.83 -0.51 -0.56 0.21 ...
 $ parented       : num [1:260] 2 2 2 2 2 2 2 3 2 3 ...
 $ mathscore      : num [1:260] 48 48 53 42 43 57 33 64 36 56 ...
 $ classstruct    : num [1:260] 2 2 2 2 2 2 2 2 2 2 ...
 $ schoolsize     : num [1:260] 3 3 3 3 3 3 3 3 3 3 ...
 $ urbanicity     : num [1:260] 2 2 2 2 2 2 2 2 2 2 ...
 $ geography      : num [1:260] 2 2 2 2 2 2 2 2 2 2 ...
 $ percentminority: num [1:260] 0 0 0 0 0 0 0 0 0 0 ...
 $ stuteachratio  : num [1:260] 19 19 19 19 19 19 19 19 19 19 ...
 - attr(*, "spec")=
  .. cols(
  ..   Schoolid = col_double(),
  ..   studentid = col_double(),
  ..   sex = col_double(),
  ..   race = col_double(),
  ..   timeonmath = col_double(),
  ..   schooltype = col_character(),
  ..   ses = col_double(),
  ..   parented = col_double(),
  ..   mathscore = col_double(),
  ..   classstruct = col_double(),
  ..   schoolsize = col_double(),
  ..   urbanicity = col_double(),
  ..   geography = col_double(),
  ..   percentminority = col_double(),
  ..   stuteachratio = col_double()
  .. )
 - attr(*, "problems")=&lt;externalptr&gt; </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(nels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 15
  Schoolid studentid   sex  race timeonmath schooltype   ses parented mathscore
     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1     7472         3     2     4          1 public     -0.13        2        48
2     7472         8     1     4          0 public     -0.39        2        48
3     7472        13     1     4          0 public     -0.8         2        53
4     7472        17     1     4          1 public     -0.72        2        42
5     7472        27     2     4          2 public     -0.74        2        43
6     7472        28     2     4          1 public     -0.58        2        57
# ℹ 6 more variables: classstruct &lt;dbl&gt;, schoolsize &lt;dbl&gt;, urbanicity &lt;dbl&gt;,
#   geography &lt;dbl&gt;, percentminority &lt;dbl&gt;, stuteachratio &lt;dbl&gt;</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Question: What are the fixed effects?</p>
</blockquote>
<blockquote class="blockquote">
<p>Question: What is the random factor?</p>
</blockquote>
<blockquote class="blockquote">
<p>Question: What changes might you want to make to the data structure?</p>
</blockquote>
</section>
<section id="lets-make-that-change-to-the-data." class="level2">
<h2 class="anchored" data-anchor-id="lets-make-that-change-to-the-data.">Let’s make that change to the data.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#students: make schoolid and schooltype a factor</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>nels <span class="ot">&lt;-</span> nels <span class="sc">%&gt;%</span> </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Schoolid =</span> <span class="fu">as.factor</span>(Schoolid),</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">schooltype =</span> <span class="fu">as.factor</span>(schooltype))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="now-lets-get-some-summary-statistics-about-our-data." class="level2">
<h2 class="anchored" data-anchor-id="now-lets-get-some-summary-statistics-about-our-data.">Now, let’s get some summary statistics about our data.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> nels <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Schoolid) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_students =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_clusters =</span> <span class="fu">n</span>(),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_students =</span> <span class="fu">sum</span>(n_students),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">average_students_per_classroom =</span> <span class="fu">mean</span>(n_students),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">SD_students_per_classroom =</span> <span class="fu">sd</span>(n_students),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_students_in_classroom =</span> <span class="fu">min</span>(n_students),</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_students_in_classroom =</span> <span class="fu">max</span>(n_students)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracting the values to variables for easier printing later</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>n_clusters <span class="ot">&lt;-</span> summary_stats<span class="sc">$</span>n_clusters</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>total_students <span class="ot">&lt;-</span> summary_stats<span class="sc">$</span>total_students</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>average_students <span class="ot">&lt;-</span> summary_stats<span class="sc">$</span>average_students_per_classroom</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>sd_students <span class="ot">&lt;-</span> summary_stats<span class="sc">$</span>SD_students_per_classroom</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>min_students <span class="ot">&lt;-</span> summary_stats<span class="sc">$</span>min_students_in_classroom</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>max_students <span class="ot">&lt;-</span> summary_stats<span class="sc">$</span>max_students_in_classroom</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="to-aid-in-interpretation-lets-center-the-timeonmath-variable." class="level2">
<h2 class="anchored" data-anchor-id="to-aid-in-interpretation-lets-center-the-timeonmath-variable.">To aid in interpretation, lets center the <code>timeonmath</code> variable.</h2>
<blockquote class="blockquote">
<p>Question: Do we want to group mean center or grand mean center?</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#lots of ways to do this, first get means for each school</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>school_means <span class="ot">&lt;-</span> nels <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Schoolid) <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_time =</span> <span class="fu">mean</span>(timeonmath, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">#join with nels data and then center</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>nels <span class="ot">&lt;-</span> nels <span class="sc">%&gt;%</span> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(school_means) <span class="sc">%&gt;%</span> </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">timeonmath_c =</span> timeonmath <span class="sc">-</span> mean_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="now-we-will-visualize-the-relations-in-our-data.-lets-create-one-visualization-examining-the-relation-between-timeonmathand-mathscore-and-another-examining-the-relation-between-schooltype-and-mathscore." class="level2">
<h2 class="anchored" data-anchor-id="now-we-will-visualize-the-relations-in-our-data.-lets-create-one-visualization-examining-the-relation-between-timeonmathand-mathscore-and-another-examining-the-relation-between-schooltype-and-mathscore.">Now, we will visualize the relations in our data. Let’s create one visualization examining the relation between <code>timeonmath</code>and <code>mathscore</code> and another examining the relation between <code>schooltype</code> and <code>mathscore</code>.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#students: fill in the code below to create these visualizations</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nels, <span class="fu">aes</span>(<span class="at">x =</span> timeonmath, <span class="at">y =</span> mathscore, <span class="at">group =</span> Schoolid)) <span class="sc">+</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">as.factor</span>(Schoolid))) <span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="fu">aes</span>(<span class="at">group =</span> Schoolid, <span class="at">color =</span> <span class="fu">as.factor</span>(Schoolid))) <span class="sc">+</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Effect of Time on Math on Math Score by School"</span>, <span class="at">x =</span> <span class="st">"Time on Math"</span>, <span class="at">y =</span> <span class="st">"Math Score"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-lab-starter-shared_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nels, <span class="fu">aes</span>(<span class="at">x =</span> schooltype, <span class="at">y =</span> mathscore, <span class="at">fill =</span> schooltype)) <span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rain</span>(<span class="at">rain.side=</span><span class="st">"l"</span>) <span class="sc">+</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"School Type"</span>, <span class="at">y=</span><span class="st">"Math Score"</span>, <span class="at">title=</span><span class="st">"Effect of School Type on Math Score"</span>) <span class="sc">+</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-lab-starter-shared_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>Question: What do these plots suggest?</p>
</blockquote>
</section>
<section id="first-we-may-want-to-know-how-much-of-the-variance-in-mathscore-is-explained-by-schoolid.-we-did-this-last-week-but-lets-get-the-icc-using-the-null-model." class="level2">
<h2 class="anchored" data-anchor-id="first-we-may-want-to-know-how-much-of-the-variance-in-mathscore-is-explained-by-schoolid.-we-did-this-last-week-but-lets-get-the-icc-using-the-null-model.">First, we may want to know how much of the variance in <code>mathscore</code> is explained by <code>Schoolid</code>. We did this last week, but let’s get the ICC using the null model.</h2>
<blockquote class="blockquote">
<p>Question: What goes into the null model?</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#students: fit the null model and calculate the ICC "by hand"</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">#fit the null model</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>null <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mathscore <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Schoolid), <span class="at">data =</span> nels)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(null)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mathscore ~ 1 + (1 | Schoolid)
   Data: nels

REML criterion at convergence: 1871.7

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.34027 -0.65554 -0.08304  0.54211  2.87452 

Random effects:
 Groups   Name        Variance Std.Dev.
 Schoolid (Intercept) 34.01    5.832   
 Residual             72.26    8.500   
Number of obs: 260, groups:  Schoolid, 10

Fixed effects:
            Estimate Std. Error     df t value Pr(&gt;|t|)    
(Intercept)   48.861      1.927  9.631   25.35 3.85e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#first, lets calculate the ICC "by hand" from the output (between groups / (between groups + within groups))</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fl">34.01</span> <span class="sc">/</span> (<span class="fl">34.01+72.26</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3200339</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#now, let's use the `icc` function in `{easystats}` to generate the ICC.</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">icc</span>(null)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Intraclass Correlation Coefficient

    Adjusted ICC: 0.320
  Unadjusted ICC: 0.320</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Question: How do you interpret the ICC? Should we be concerned about clustering in our data?</p>
</blockquote>
</section>
<section id="we-will-now-build-up-from-the-last-model.-fit-a-model-that-includes-timeonmath-and-schooltype-no-interaction.-include-a-random-intercept-for-schoolid." class="level2">
<h2 class="anchored" data-anchor-id="we-will-now-build-up-from-the-last-model.-fit-a-model-that-includes-timeonmath-and-schooltype-no-interaction.-include-a-random-intercept-for-schoolid.">We will now build up from the last model. Fit a model that includes <code>timeonmath</code> and <code>schooltype</code> (no interaction). Include a random intercept for <code>Schoolid</code>.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>model_1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mathscore <span class="sc">~</span> timeonmath_c <span class="sc">+</span> schooltype <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Schoolid), <span class="at">data =</span> nels)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mathscore ~ timeonmath_c + schooltype + (1 | Schoolid)
   Data: nels

REML criterion at convergence: 1826.9

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.5898 -0.6920 -0.0387  0.5858  3.2982 

Random effects:
 Groups   Name        Variance Std.Dev.
 Schoolid (Intercept)  8.744   2.957   
 Residual             64.571   8.036   
Number of obs: 260, groups:  Schoolid, 10

Fixed effects:
                 Estimate Std. Error       df t value Pr(&gt;|t|)    
(Intercept)       62.8209     3.1157   5.5361  20.163 2.15e-06 ***
timeonmath_c       2.1366     0.3836 249.1343   5.571 6.57e-08 ***
schooltypepublic -15.5963     3.3188   5.7738  -4.699  0.00368 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) tmnmt_
timeonmth_c  0.000       
schltyppblc -0.939  0.000</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Question: How would you interpret the fixed effects in this model? …the random effects?</p>
</blockquote>
</section>
<section id="lets-continue-building-our-model.-fit-a-model-that-includes-an-interaction-between-timeonmath-and-schooltype." class="level2">
<h2 class="anchored" data-anchor-id="lets-continue-building-our-model.-fit-a-model-that-includes-an-interaction-between-timeonmath-and-schooltype.">Let’s continue building our model. Fit a model that includes an interaction between <code>timeonmath</code> and <code>schooltype</code>.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>model_2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mathscore <span class="sc">~</span> timeonmath_c <span class="sc">*</span> schooltype <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>Schoolid), <span class="at">data =</span> nels)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mathscore ~ timeonmath_c * schooltype + (1 | Schoolid)
   Data: nels

REML criterion at convergence: 1819.6

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.9967 -0.6769 -0.0299  0.6147  3.5834 

Random effects:
 Groups   Name        Variance Std.Dev.
 Schoolid (Intercept)  8.80    2.966   
 Residual             63.28    7.955   
Number of obs: 260, groups:  Schoolid, 10

Fixed effects:
                              Estimate Std. Error       df t value Pr(&gt;|t|)    
(Intercept)                    62.8209     3.1216   5.5804  20.124 2.01e-06 ***
timeonmath_c                    1.0946     0.5682 248.1315   1.927  0.05517 .  
schooltypepublic              -15.5968     3.3243   5.8143  -4.692  0.00364 ** 
timeonmath_c:schooltypepublic   1.8830     0.7638 248.1315   2.465  0.01436 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) tmnmt_ schlty
timeonmth_c  0.000              
schltyppblc -0.939  0.000       
tmnmth_c:sc  0.000 -0.744  0.000</code></pre>
</div>
</div>
</section>
<section id="now-well-use-a-likelihood-ratio-test-to-compare-the-model-with-just-main-effects-and-the-interaction-model." class="level2">
<h2 class="anchored" data-anchor-id="now-well-use-a-likelihood-ratio-test-to-compare-the-model-with-just-main-effects-and-the-interaction-model.">Now, we’ll use a likelihood ratio test to compare the model with just main effects and the interaction model.</h2>
<blockquote class="blockquote">
<p>Question: What method of maximum likelihood estimation should we use here (FIML or REML)? Why?</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#students: run the likelihood ratio test, use the correct maximum likelihood estimation</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">test_likelihoodratio</span>(model_1, model_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Likelihood-Ratio-Test (LRT) for Model Comparison (ML-estimator)

Name    |           Model | df | df_diff | Chi2 |     p
-------------------------------------------------------
model_1 | lmerModLmerTest |  5 |         |      |      
model_2 | lmerModLmerTest |  6 |       1 | 6.06 | 0.014</code></pre>
</div>
</div>
</section>
<section id="for-completeness-lets-also-take-a-look-at-the-aic-and-bic-values." class="level2">
<h2 class="anchored" data-anchor-id="for-completeness-lets-also-take-a-look-at-the-aic-and-bic-values.">For completeness, let’s also take a look at the AIC and BIC values.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_performance</span>(model_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Indices of model performance

AIC      |     AICc |      BIC | R2 (cond.) | R2 (marg.) |   ICC |  RMSE | Sigma
--------------------------------------------------------------------------------
1836.886 | 1837.122 | 1854.690 |      0.495 |      0.426 | 0.119 | 7.896 | 8.036</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_performance</span>(model_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Indices of model performance

AIC      |     AICc |      BIC | R2 (cond.) | R2 (marg.) |   ICC |  RMSE | Sigma
--------------------------------------------------------------------------------
1831.560 | 1831.892 | 1852.924 |      0.506 |      0.437 | 0.122 | 7.801 | 7.955</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_performance</span>(model_1)<span class="sc">$</span>AIC <span class="sc">-</span> <span class="fu">model_performance</span>(model_2)<span class="sc">$</span>AIC </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.326042</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_performance</span>(model_1)<span class="sc">$</span>BIC <span class="sc">-</span> <span class="fu">model_performance</span>(model_2)<span class="sc">$</span>BIC </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.765361</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Question: What can we say from the AIC/BIC analysis?</p>
</blockquote>
</section>
<section id="using-the-best-fitting-model-from-above-fit-a-model-that-adds-random-slopes-for-timeonmath_c" class="level2">
<h2 class="anchored" data-anchor-id="using-the-best-fitting-model-from-above-fit-a-model-that-adds-random-slopes-for-timeonmath_c">Using the best fitting model from above, fit a model that adds random slopes for <code>timeonmath_c</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#students: add a random slope for timeonmath_c</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>model_3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mathscore <span class="sc">~</span> timeonmath_c <span class="sc">*</span> schooltype <span class="sc">+</span> (timeonmath_c<span class="sc">|</span>Schoolid), <span class="at">data =</span> nels)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mathscore ~ timeonmath_c * schooltype + (timeonmath_c | Schoolid)
   Data: nels

REML criterion at convergence: 1744.9

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.63573 -0.56011 -0.05364  0.63859  2.58757 

Random effects:
 Groups   Name         Variance Std.Dev. Corr
 Schoolid (Intercept)   9.686   3.112        
          timeonmath_c 25.249   5.025    0.42
 Residual              43.106   6.565        
Number of obs: 260, groups:  Schoolid, 10

Fixed effects:
                              Estimate Std. Error      df t value Pr(&gt;|t|)    
(Intercept)                     62.821      3.214   6.300  19.546 7.08e-07 ***
timeonmath_c                     1.095      5.047   6.978   0.217  0.83449    
schooltypepublic               -15.604      3.410   6.469  -4.576  0.00313 ** 
timeonmath_c:schooltypepublic    1.071      5.337   7.070   0.201  0.84666    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) tmnmt_ schlty
timeonmth_c  0.410              
schltyppblc -0.942 -0.386       
tmnmth_c:sc -0.387 -0.946  0.406</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_likelihoodratio</span>(model_2, model_3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Likelihood-Ratio-Test (LRT) for Model Comparison (REML-estimator)

Name    |           Model | df | df_diff |  Chi2 |      p
---------------------------------------------------------
model_2 | lmerModLmerTest |  6 |         |       |       
model_3 | lmerModLmerTest |  8 |       2 | 74.62 | &lt; .001</code></pre>
</div>
</div>
</section>
<section id="lets-additionally-add-a-random-slope-for-schooltype." class="level2">
<h2 class="anchored" data-anchor-id="lets-additionally-add-a-random-slope-for-schooltype.">Let’s additionally add a random slope for <code>schooltype</code>.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#students: add a random slope for schooltype</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>model_4 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mathscore <span class="sc">~</span> timeonmath_c <span class="sc">*</span> schooltype <span class="sc">+</span> (timeonmath_c <span class="sc">+</span> schooltype<span class="sc">|</span>Schoolid), <span class="at">data =</span> nels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, :
unable to evaluate scaled gradient</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, :
Model failed to converge: degenerate Hessian with 2 negative eigenvalues</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Model failed to converge with 2 negative eigenvalues: -9.6e-06
-6.1e-03</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mathscore ~ timeonmath_c * schooltype + (timeonmath_c + schooltype |  
    Schoolid)
   Data: nels

REML criterion at convergence: 1744.9

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.63573 -0.56011 -0.05364  0.63860  2.58756 

Random effects:
 Groups   Name             Variance Std.Dev. Corr       
 Schoolid (Intercept)      41.65    6.454               
          timeonmath_c     25.25    5.025    -0.03      
          schooltypepublic 48.63    6.973    -0.90  0.22
 Residual                  43.11    6.565               
Number of obs: 260, groups:  Schoolid, 10

Fixed effects:
                                Estimate Std. Error         df t value Pr(&gt;|t|)
(Intercept)                    62.820896   6.503462   0.007349   9.660    0.961
timeonmath_c                    1.094640   5.046848   6.977536   0.217    0.834
schooltypepublic              -15.603806   6.602670   0.007807  -2.363    0.969
timeonmath_c:schooltypepublic   1.070671   5.337472   7.069189   0.201    0.847

Correlation of Fixed Effects:
            (Intr) tmnmt_ schlty
timeonmth_c -0.032              
schltyppblc -0.985  0.032       
tmnmth_c:sc  0.031 -0.946 -0.009
optimizer (nloptwrap) convergence code: 0 (OK)
unable to evaluate scaled gradient
Model failed to converge: degenerate  Hessian with 2 negative eigenvalues</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Question: What happened when you added the random slope for <code>schooltype</code>? Why do you think this happened? What should you do?</p>
</blockquote>
</section>
<section id="we-might-want-to-know-whether-its-useful-to-include-a-random-slope-for-timeonmath_c.-to-assess-this-lets-compare-the-model-with-only-a-random-intercept-model_2-to-a-model-with-a-random-intercept-and-random-slope-for-timeonmath_c-model_3." class="level2">
<h2 class="anchored" data-anchor-id="we-might-want-to-know-whether-its-useful-to-include-a-random-slope-for-timeonmath_c.-to-assess-this-lets-compare-the-model-with-only-a-random-intercept-model_2-to-a-model-with-a-random-intercept-and-random-slope-for-timeonmath_c-model_3.">We might want to know whether its useful to include a random slope for <code>timeonmath_c</code>. To assess this, let’s compare the model with only a random intercept (model_2) to a model with a random intercept and random slope for <code>timeonmath_c</code> (model_3).</h2>
<blockquote class="blockquote">
<p>Question: What method of maximum likelihood estimation should we use here (FIML or REML)? Why?</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_likelihoodratio</span>(model_2, model_3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Likelihood-Ratio-Test (LRT) for Model Comparison (REML-estimator)

Name    |           Model | df | df_diff |  Chi2 |      p
---------------------------------------------------------
model_2 | lmerModLmerTest |  6 |         |       |       
model_3 | lmerModLmerTest |  8 |       2 | 74.62 | &lt; .001</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Question: Which is the best fitting model?</p>
</blockquote>
</section>
<section id="using-the-best-model-interpret-the-fixed-and-random-effects." class="level2">
<h2 class="anchored" data-anchor-id="using-the-best-model-interpret-the-fixed-and-random-effects.">Using the best model, interpret the fixed and random effects.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mathscore ~ timeonmath_c * schooltype + (timeonmath_c | Schoolid)
   Data: nels

REML criterion at convergence: 1744.9

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.63573 -0.56011 -0.05364  0.63859  2.58757 

Random effects:
 Groups   Name         Variance Std.Dev. Corr
 Schoolid (Intercept)   9.686   3.112        
          timeonmath_c 25.249   5.025    0.42
 Residual              43.106   6.565        
Number of obs: 260, groups:  Schoolid, 10

Fixed effects:
                              Estimate Std. Error      df t value Pr(&gt;|t|)    
(Intercept)                     62.821      3.214   6.300  19.546 7.08e-07 ***
timeonmath_c                     1.095      5.047   6.978   0.217  0.83449    
schooltypepublic               -15.604      3.410   6.469  -4.576  0.00313 ** 
timeonmath_c:schooltypepublic    1.071      5.337   7.070   0.201  0.84666    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) tmnmt_ schlty
timeonmth_c  0.410              
schltyppblc -0.942 -0.386       
tmnmth_c:sc -0.387 -0.946  0.406</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(model_3, <span class="at">effects=</span><span class="st">"fixed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Fixed Effects

Parameter                          | Coefficient |   SE |          95% CI
-------------------------------------------------------------------------
(Intercept)                        |       62.82 | 3.21 | [ 56.49, 69.15]
timeonmath c                       |        1.09 | 5.05 | [ -8.84, 11.03]
schooltype [public]                |      -15.60 | 3.41 | [-22.32, -8.89]
timeonmath c × schooltype [public] |        1.07 | 5.34 | [ -9.44, 11.58]

Parameter                          | t(252) |      p
----------------------------------------------------
(Intercept)                        |  19.55 | &lt; .001
timeonmath c                       |   0.22 | 0.828 
schooltype [public]                |  -4.58 | &lt; .001
timeonmath c × schooltype [public] |   0.20 | 0.841 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(model_3, <span class="at">effects=</span><span class="st">"random"</span>) <span class="co">#note that the pulls out the SD, not the variance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Random Effects

Parameter                              | Coefficient |   SE |        95% CI
---------------------------------------------------------------------------
SD (Intercept: Schoolid)               |        3.11 | 0.94 | [ 1.72, 5.63]
SD (timeonmath_c: Schoolid)            |        5.02 | 1.35 | [ 2.97, 8.51]
Cor (Intercept~timeonmath_c: Schoolid) |        0.42 | 0.43 | [-0.52, 0.90]
SD (Residual)                          |        6.57 | 0.30 | [ 6.00, 7.18]</code></pre>
</div>
</div>
</section>
<section id="note-if-there-was-an-issue-with-the-intercept-and-slope-correlation-e.g.-the-model-was-singular-because-the-correlation-was-1-or--1-i-could-remove-it-from-the-model." class="level2">
<h2 class="anchored" data-anchor-id="note-if-there-was-an-issue-with-the-intercept-and-slope-correlation-e.g.-the-model-was-singular-because-the-correlation-was-1-or--1-i-could-remove-it-from-the-model.">Note: If there was an issue with the intercept and slope correlation (e.g., the model was singular because the correlation was 1 or -1), I could remove it from the model.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">#here's how I'd do that. notice that the correlation is no longer part of the summary.</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>model_5 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mathscore <span class="sc">~</span> timeonmath_c <span class="sc">*</span> schooltype <span class="sc">+</span> (timeonmath_c<span class="sc">||</span>Schoolid), <span class="at">data =</span> nels)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: mathscore ~ timeonmath_c * schooltype + (timeonmath_c || Schoolid)
   Data: nels

REML criterion at convergence: 1746.1

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.63619 -0.56061 -0.06086  0.62685  2.55310 

Random effects:
 Groups     Name         Variance Std.Dev.
 Schoolid   (Intercept)   9.683   3.112   
 Schoolid.1 timeonmath_c 25.577   5.057   
 Residual                43.091   6.564   
Number of obs: 260, groups:  Schoolid, 10

Fixed effects:
                              Estimate Std. Error      df t value Pr(&gt;|t|)    
(Intercept)                     62.821      3.214   6.300  19.549 7.07e-07 ***
timeonmath_c                     1.095      5.079   6.987   0.216  0.83552    
schooltypepublic               -15.605      3.410   6.469  -4.576  0.00313 ** 
timeonmath_c:schooltypepublic    1.042      5.371   7.078   0.194  0.85160    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) tmnmt_ schlty
timeonmth_c  0.000              
schltyppblc -0.942  0.000       
tmnmth_c:sc  0.000 -0.946  0.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_parameters</span>(model_5, <span class="at">effects=</span><span class="st">"random"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Random Effects

Parameter                   | Coefficient |   SE |       95% CI
---------------------------------------------------------------
SD (Intercept: Schoolid)    |        3.11 | 0.94 | [1.72, 5.63]
SD (timeonmath_c: Schoolid) |        5.06 | 1.36 | [2.99, 8.56]
SD (Residual)               |        6.56 | 0.30 | [6.00, 7.18]</code></pre>
</div>
</div>
</section>
<section id="examine-the-effect-size.-use-pseudo-r2-for-the-overall-model-semi-r2-for-the-timeonmath-effect-and-cohens-d-for-the-schooltype-effect." class="level2">
<h2 class="anchored" data-anchor-id="examine-the-effect-size.-use-pseudo-r2-for-the-overall-model-semi-r2-for-the-timeonmath-effect-and-cohens-d-for-the-schooltype-effect.">Examine the effect size. Use pseudo-R^2 for the overall model, semi-R^2 for the <code>timeonmath</code> effect and Cohen’s d for the <code>schooltype</code> effect.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#students: get these values</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="co">#pseudo R^2 (conditional = full model, marginal = fixed effects only)</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="fu">r2</span>(model_3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># R2 for Mixed Models

  Conditional R2: 0.708
     Marginal R2: 0.353</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#semi-R^2</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">partR2</span>(model_2, <span class="at">data =</span> nels, <span class="at">partvars =</span> <span class="fu">c</span>(<span class="st">"timeonmath_c"</span>), <span class="at">R2_type =</span> <span class="st">"marginal"</span>, <span class="at">nboot =</span> <span class="dv">10</span>, <span class="at">CI =</span> <span class="fl">0.95</span>) <span class="co">#VERY small effect!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

R2 (marginal) and 95% CI for the full model: 
 R2     CI_lower CI_upper nboot ndf
 0.4369 0.294    0.4862   10    4  

----------

Part (semi-partial) R2:
 Predictor(s) R2     CI_lower CI_upper nboot ndf
 Model        0.4369 0.294    0.4862   10    4  
 timeonmath_c 0.0000 0.000    0.1366   10    4  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">#cohen's d = effect / sqrt(var(int) + var(slope) + var(resid))</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">15.605</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fl">9.683+25.577+25.577</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -2.00069</code></pre>
</div>
</div>
</section>
<section id="visualize-variation-in-the-intercept-and-slope." class="level2">
<h2 class="anchored" data-anchor-id="visualize-variation-in-the-intercept-and-slope.">Visualize variation in the intercept and slope.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>random <span class="ot">&lt;-</span> <span class="fu">estimate_grouplevel</span>(model_3)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(random)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-lab-starter-shared_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="finally-lets-check-the-assumptions-of-our-model." class="level2">
<h2 class="anchored" data-anchor-id="finally-lets-check-the-assumptions-of-our-model.">Finally, let’s check the assumptions of our model.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(model_3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-lab-starter-shared_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>Question: How does this look?</p>
</blockquote>
<blockquote class="blockquote">
<p>Question: Why would we <em>NOT</em> want to use these data in a real assessment of the effect of school type on the relation between time spent on math homework and math scores?</p>
</blockquote>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>